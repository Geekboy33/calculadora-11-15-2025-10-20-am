<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Limpiar Cach√© - DAES CoreBanking</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #000000 0%, #0a0a0a 100%);
      color: #00ff88;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }
    .container {
      max-width: 600px;
      padding: 40px;
      background: rgba(13, 13, 13, 0.9);
      border: 2px solid #00ff88;
      border-radius: 20px;
      box-shadow: 0 0 40px rgba(0, 255, 136, 0.3);
      text-align: center;
    }
    h1 {
      margin: 0 0 20px;
      color: #00ff88;
      font-size: 2em;
      text-shadow: 0 0 20px rgba(0, 255, 136, 0.6);
    }
    p {
      margin: 15px 0;
      color: #e0ffe0;
      line-height: 1.6;
    }
    button {
      margin: 10px;
      padding: 15px 40px;
      font-size: 16px;
      font-weight: bold;
      border: 2px solid #00ff88;
      background: linear-gradient(135deg, #00ff88, #00cc6a);
      color: #000;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 0 20px rgba(0, 255, 136, 0.4);
    }
    button:hover {
      transform: scale(1.05);
      box-shadow: 0 0 30px rgba(0, 255, 136, 0.6);
    }
    .status {
      margin-top: 20px;
      padding: 15px;
      background: rgba(0, 255, 136, 0.1);
      border: 1px solid #00ff88;
      border-radius: 10px;
      display: none;
    }
    .status.show {
      display: block;
    }
    .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #00ff88;
      border-top-color: transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîß Limpiar Cach√©</h1>
    <p>Si experimentas errores al cargar m√≥dulos, usa esta herramienta para limpiar la cach√© del navegador.</p>
    
    <button onclick="clearAll()">
      üßπ Limpiar Todo y Recargar
    </button>
    
    <button onclick="clearServiceWorker()">
      ‚öôÔ∏è Limpiar Service Worker
    </button>
    
    <button onclick="goToApp()">
      ‚Üê Volver a la Aplicaci√≥n
    </button>
    
    <div id="status" class="status">
      <div class="spinner"></div>
      <p id="statusText">Procesando...</p>
    </div>
  </div>

  <script>
    function showStatus(text) {
      const status = document.getElementById('status');
      const statusText = document.getElementById('statusText');
      statusText.textContent = text;
      status.classList.add('show');
      
      setTimeout(() => {
        status.classList.remove('show');
      }, 3000);
    }

    async function clearAll() {
      try {
        // Limpiar localStorage
        localStorage.clear();
        console.log('‚úÖ localStorage limpiado');
        
        // Limpiar sessionStorage
        sessionStorage.clear();
        console.log('‚úÖ sessionStorage limpiado');
        
        // Limpiar IndexedDB
        const databases = await indexedDB.databases();
        for (const db of databases) {
          if (db.name) {
            indexedDB.deleteDatabase(db.name);
            console.log('‚úÖ IndexedDB eliminado:', db.name);
          }
        }
        
        // Limpiar cach√© de navegador
        if ('caches' in window) {
          const cacheNames = await caches.keys();
          for (const name of cacheNames) {
            await caches.delete(name);
            console.log('‚úÖ Cach√© eliminado:', name);
          }
        }
        
        // Desregistrar Service Worker
        if ('serviceWorker' in navigator) {
          const registrations = await navigator.serviceWorker.getRegistrations();
          for (const registration of registrations) {
            await registration.unregister();
            console.log('‚úÖ Service Worker desregistrado');
          }
        }
        
        showStatus('‚úÖ Cach√© limpiada. Recargando...');
        
        setTimeout(() => {
          window.location.href = '/';
        }, 1500);
        
      } catch (error) {
        console.error('Error limpiando cach√©:', error);
        alert('Error al limpiar cach√©: ' + error.message);
      }
    }

    async function clearServiceWorker() {
      try {
        if ('serviceWorker' in navigator) {
          const registrations = await navigator.serviceWorker.getRegistrations();
          for (const registration of registrations) {
            await registration.unregister();
          }
          showStatus('‚úÖ Service Worker limpiado. Recarga la p√°gina (Ctrl+Shift+R)');
        } else {
          showStatus('‚ö†Ô∏è Service Worker no soportado en este navegador');
        }
      } catch (error) {
        console.error('Error:', error);
        alert('Error: ' + error.message);
      }
    }

    function goToApp() {
      window.location.href = '/';
    }
  </script>
</body>
</html>
